# app优化



绘制优化。

- 绘制层级太深
- 页面太复杂， 控件太多
- 不合理的刷新频率

数据优化

- 在UI线程处理数据
- 数据处理占用太多CPU，主线程得不到时间片
- 频繁申请内存导致多次GC，从而导致卡顿



应用层，测量布局绘制。

无论是测量还是布局，它对于一颗 ViewTree都是以深度优先为准，所以深度太深，会导致测量布局消耗很多时间。

绘制，软件绘制。



常用优化工具：

SystemTrace，TraceView，GpuRender指标。等的用法。





#　启动优化

主要优化冷启动，adb shell am start 。。。命令可以查看当前apk的启动时间，支持多次启动测试。

如果发现启动的白屏黑屏问题。两个解决方案，这是由于app启动时，系统会创建出一个空白window，这个window有可能是白色也有可能是黑色。我们可以指定这个空白window的主题，只不过这个主题最好是和页面的背景色不要相差太大，不然会感觉很突兀。也可以把空白window主题设置成全透明，这样，就会在app启动的指令下达之后，卡一段时间，相当于没动静，然后app才打开。 两种方式，酌情使用。

另外，app启动过程中所做的一些工作，也可以进行分类来进行处理。

| 类别           | 处理方式                                                     |
| -------------- | ------------------------------------------------------------ |
| 必要且耗时     | 考虑用子线程                                                 |
| 必要且不耗时   | 这个直接在主线程去做                                         |
| 非必要且耗时   | 不要在启动的时候做，到需要用到的时候再去初始化，比如 数据上报，完全可以延迟上报 |
| 非必要且不耗时 | 不要在启动的时候做                                           |

造成启动速度减慢的可能因素：

| 序号 | 因素             |
| ---- | ---------------- |
| 1    | 频繁IO操作       |
| 2    | 序列化，反序列化 |
| 3    | 网络耗时操作     |
| 4    | 布局嵌套过深     |

通用的启动优化方案：

| 序号 | 方案                                                         |
| ---- | ------------------------------------------------------------ |
| 1    | 利用主题快速显示界面，把主题变成启动页面的背景色             |
| 2    | 异步初始化组件（好像有一个最新的AsyncLayoutInflater）        |
| 3    | 梳理启动时的业务，进行分步骤，延迟加载                       |
| 4    | 正确使用线程，启动的时候就不要初始化线程池了，直接new Thread反而效率更高 |
| 5    | 去掉无用逻辑                                                 |

卡顿监听：
可以到Handler的源码内去监听 某个事件的处理时间是不是超过了16MS，如果超过，那么人眼就有可能感觉到明显卡顿。



# Apk文件大小优化

代码混淆，可以减小源码部分所占用的字节码长度。

资源优化，资源包括 res下的图片，图片用webp替代png，jpeg等，画质会有所降低，但是人眼感受不到降低。

有一个比较坑的地方，as打包可以自动去除无用的资源文件，但是这个必须先打开代码混淆,去无用资源才会生效。

SO库优化，不要把没必要的abi-filter打进去。





