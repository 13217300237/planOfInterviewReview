View中一些画面的绘制比较耗时，怎么办，不处理就会造成卡顿。



使用SurfaceView就行了。它是View的一个子类。它专门应对耗时绘制，频繁绘制。



对比SurfaceView的绘制和一般View的绘制的区别：

| SurfaceView      | View                               |
| ---------------- | ---------------------------------- |
| 支持子线程中绘制 | 只能在主线程中绘制                 |
| 支持指定频率刷新 | 无法指定刷新频率，只能draw中调draw |
| 支持双缓冲机制   | 不支持                             |

所谓双缓冲机制，就是两层缓冲区，一个主线程前台缓冲区，一个子线程后台缓冲区。

SurfaceView 支持子线程绘制Surface，然后把Surface交给主线程去渲染。

在双缓冲区的支持下，就算后台缓冲区的绘制任务再繁重，前台缓冲区也不会有卡顿。一旦后台缓冲区绘制完成，就会交给前台去渲染显示出来。前台缓冲区，主线程，都不会感觉到卡顿，掉帧。



使用SurfaceView有另外一个问题，那就是，事件同步问题，因为 触摸事件的接收是主线程去做的。而SurfaceView的绘制是子线程去做的。两个线程之间存在同步问题，如果收到触摸事件之后，子线程没有及时去更新UI，容易让用户感觉ANR。处理方式也很简单，就是 建立事件队列，主线程收到事件之后把事件放入队列，并且通知子线程。子线程在后台缓冲区生成Surface然后通知主线程去更新Surface.



